<!DOCTYPE html>
<html lang="en">
<!-- [Head] start -->

<!-- CURRENTLY ASSUMES FLASK IS RUNNING AT :5000 PORT -->
<!-- CURRENTLY ASSUMES FLASK IS RUNNING AT :5000 PORT -->
<!-- change the port accordingly!! as we run it -->

<head>
  @@include('../layouts/head-page-meta.html', {'title': 'Typography'}) @@include('../layouts/head-css.html')
</head>
<!-- [Head] end -->
<!-- [Body] Start -->

<body @@bodySetup>
  @@include('../layouts/layout-vertical.html')

  <!-- [ Main Content ] start -->
  <div class="pc-container">
    <div class="pc-content">
        <!-- [ Typography ] end -->

      <section style="background-color: #eee;">
        <div class="container py-5">
          <div class="row d-flex justify-content-center">
            <div class="col-md-8 col-lg-6 col-xl-4">
              <div class="card" id="chat1" style="border-radius: 15px;">
                <div
                        class="card-header d-flex justify-content-between align-items-center p-3 bg-info text-white border-bottom-0"
                        style="border-top-left-radius: 15px; border-top-right-radius: 15px;">
                  <i class="fas fa-angle-left"></i>
                  <p class="mb-0 fw-bold">Live chat</p>
                  <i class="fas fa-times"></i>
                </div>
                <div class="card-body" id="chat-body">
                  <!-- Chat Messages Will Be Added Dynamically Here -->
                </div>
                <div class="form-outline">
                  <textarea class="form-control" id="chat-input" rows="2" placeholder="Type your message..."></textarea>
                  <button class="btn btn-info mt-2" id="send-button">Send</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <script>
        const chatBody = document.getElementById("chat-body");
        const chatInput = document.getElementById("chat-input");
        const sendButton = document.getElementById("send-button");

        function addMessage(message, sender = "user") {
          const messageElement = document.createElement("div");
          messageElement.className = `d-flex flex-row ${sender === "bot" ? "justify-content-start" : "justify-content-end"} mb-4`;
          messageElement.innerHTML = sender === "bot"
                  ? `
        <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava1-bg.webp" alt="avatar 1"
          style="width: 45px; height: 100%;">
        <div class="p-3 ms-3" style="border-radius: 15px; background-color: rgba(57, 192, 237,.2);">
          <p class="small mb-0">${message}</p>
        </div>`
                  : `
        <div class="p-3 me-3 border" style="border-radius: 15px; background-color: #fbfbfb;">
          <p class="small mb-0">${message}</p>
        </div>
        <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava2-bg.webp" alt="avatar 1"
          style="width: 45px; height: 100%;">`;
          chatBody.appendChild(messageElement);
          chatBody.scrollTop = chatBody.scrollHeight; // Auto-scroll to the bottom
        }

        async function sendMessage() {
          const userMessage = chatInput.value.trim();
          if (!userMessage) return;

          // Display user message
          addMessage(userMessage, "user");

          // Clear input field
          chatInput.value = "";

          // Send message to backend
          try {
            const response = await fetch("http://127.0.0.1:5000/get_chat_response", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify({ message: userMessage })
            });
            const data = await response.json();

            // Display bot response
            addMessage(data.response, "bot");
          } catch (error) {
            console.error("Error communicating with the backend:", error);
            addMessage("Error: Unable to communicate with the server.", "bot");
          }
        }

        // Attach event listeners
        sendButton.addEventListener("click", sendMessage);
        chatInput.addEventListener("keypress", (event) => {
          if (event.key === "Enter" && !event.shiftKey) {
            event.preventDefault(); // Prevent line break
            sendMessage();
          }
        });
      </script>


      <!-- [ Main Content ] end -->
    </div>
  </div>
  <!-- [ Main Content ] end -->
  @@include('../layouts/footer-block.html') @@include('../layouts/footer-js.html')
  
</body>
<!-- [Body] end -->
</html>
